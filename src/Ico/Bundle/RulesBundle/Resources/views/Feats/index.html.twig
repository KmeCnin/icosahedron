{% extends "IcoRulesBundle::layout.html.twig" %}
{% form_theme filter 'IcoAppBundle:Form:fields.html.twig' %}

{% block content %}
<div class="well bs-component">
    
    {% if filter.keywords.vars.value is not empty %}
	   {% set keywords = filter.keywords.vars.value|split(',') %}
	   <script>
		  var keywords_contexts_list = [0, 3]; // Index des colonnes où chercher les mots-clés à surligner dans la liste de résultats
		  var keywords_contexts_modal = [0, 3]; // Index des colonnes où chercher les mots-clés à surligner dans la modale
		  var keywords = new Array();
	   {% for keyword in keywords %}
		  keywords.push("{{ keyword|trim }}");
	   {% endfor %}
	   </script>
    {% endif %}
	   
    {{ form_start(filter) }}
	   <fieldset class="row">
		  <legend class="col-xs-12">Recherche <small class="text-muted">(Total de {{ pagination.getTotalItemCount }} don{% if pagination.getTotalItemCount > 1 %}s{% endif %} trouvé{% if pagination.getTotalItemCount > 1 %}s{% endif %})</small> <button type="submit" class="btn btn-default btn-sm"><span class="fa fa-refresh"></span>Filtrer</button></legend>
		  <div class="col-xs-4">
			 {{ form_row(filter.keywords) }}
		  </div>
		  <div class="col-xs-4 select-multiple-wrapper">
			 {{ form_widget(filter.featTypesType) }}
			 {{ form_row(filter.featTypes) }}
		  </div>
	   </fieldset>
    {{ form_end(filter) }}
	   <script>initChosen();</script>
</div>
<table class="table table-striped table-hover table-results">
    <tr>
	   <th{% if pagination.isSorted('feat.Name') %} class="sorted"{% endif %}>{{ knp_pagination_sortable(pagination, 'Don', 'feat.name') }}</th>
	   <th>Catégories</th>
	   <th>Prérequis</th>
	   <th>Description</th>
    </tr>
	   {% for feat in pagination %}
    <tr>
	   <td class="link" data-toggle="modal" data-target="#modal_feat_{{ feat.id }}"><a>{{ feat.name }}</a></td>
	   <td>
		  {% for feattype in feat.feattypes %}{% if loop.index != 1 %}, {% endif %}{% if feattype.description is not empty %}<a class="preview text-nowrap" href="{{ path('ico_rules_feattypes_view', {'id': feattype.id}) }}">{{ feattype.name }}</a>{% else %}{{ feattype.name }}{% endif %}{% endfor %}
	   </td>
	   <td>
		  {% for featprerequisite in feat.featprerequisites %}{% if loop.index != 1 %}, {% endif %}{% if featprerequisite.link != '' %}<a class="preview text-nowrap" href="{{ featprerequisite.link|environment }}">{{ featprerequisite.name }}</a>{% else %}<span class="text-nowrap">{{ featprerequisite.name }}</span>{% endif %}{% endfor %}
	   </td>
	   <td>{{ feat.description }}</td>
    </tr>
	   {% endfor %}
</table>
    {# Modales #}
    {% for key, feat in pagination %}
<div class="modal modal-results" id="modal_feat_{{ feat.id }}" tabindex="-1" role="dialog" aria-labelledby="modal_feat_{{ feat.id }}" aria-hidden="true">
    <div class="modal-dialog modal-lg">
	   <div class="modal-content">
		  <div class="modal-header">
			 <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Fermer</span></button>
			 <h4 class="modal-title" id="myModalLabel">{{ feat.name }} <small>[Don]</small></h4>
		  </div>
		  <div class="modal-body">
			 {% include 'IcoRulesBundle:Feats:display.html.twig' with {'feat': feat} only %}
		  </div>
		  <div class="modal-footer">
			 {% if pagination[key-1] is defined %}
			 <button type="button" class="btn btn-default modalJumpPrevious" data-modal-jump="modal_feat_{{ pagination[key-1].id }}" style="float:left;"><span class="glyphicon glyphicon-chevron-left"></span> {{ pagination[key-1].name }}</button>
			 {% endif %}
			 {% if pagination[key+1] is defined %}
			 <button type="button" class="btn btn-default modalJumpNext" data-modal-jump="modal_feat_{{ pagination[key+1].id }}">{{ pagination[key+1].name }} <span class="glyphicon glyphicon-chevron-right"></span></button>
			 {% endif %}
			 <button type="button" class="btn btn-primary" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span> Fermer</button>
		  </div>
	   </div>
    </div>
</div>
    {% endfor %}
{# display navigation #}
<div class="navigation" style="text-align: center;">
{{ knp_pagination_render(pagination) }}
</div>
{% endblock %}